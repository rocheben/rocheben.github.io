<!DOCTYPE html>
<html lang="en">
<head>
	<title>WHO/Prezode indictor for human zoonotic exposure </title>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="stylesheet" href="css/leaflet.css">
    <link rel="stylesheet" href="css/qgis2web.css">
    <link rel="stylesheet" href="css/fontawesome-all.min.css">
    <style>
        html, body, #map {
            width: 80%;
            height: 80%;
            padding: 10;
            margin: 10;
        }
    </style>
    <title></title>
</head>
<body>
<p><b>Instructions:</b></p>
<p>(1) Click on the geographical unit.</p>
<p>(2) Choose the pathogen of interest</p>
<p>(3) According to your expertise, indicate your estimation (for the geographical unit and the pathogen selected) of pathogen pressure in wildlife, contact between wildlife and humans, pathogen pressure in livestock, contact between livestock and humans, contact between wildlife and livestock and your sul-trust for each estimation</p>
<p><i>N.B: You are not requested to estimate all variables. You can focus only on the variables you think you have a valuable opinion</i></p>

<div id="map"></div>

<form id="test-form">

Participant ID: <input type="text" name="participantId" id="paramDisplay" readonly>

Unit selected: <input type="text" name="unitSelected" id="iso3Display" readonly>
<p></p>

Pathogen of interest : <select name="pathogen" id="pathogen">
    <option value="">Pathogen of interest</option>
    <option value="AIV">AIV</option>
    <option value="MERS">Mers-Cov</option>
    <option value="CCHF">CCHF</option>
	<option value="WNV">West Nile Virus</option>
</select>
<p></p>
Wildlife : <select name="wildlifePressure" id="wildlifePressure">
    <option value="">Pathogen pressure in wildlife </option>
    <option value="1">Level 1</option>
    <option value="2">Level 2</option>
    <option value="3">Level 3</option>
</select>
<select name="wildlifePressureTrust" id="wildlifePressureTrust">
    <option value="">Self-trust for wildlife pathogen pressure estimation </option>
    <option value="1">None</option>
    <option value="2">Little</option>
    <option value="3">Moderate</option>
	<option value="4">High</option>
    <option value="5">Expert</option>
</select>
<select name="wildlifeContact" id="wildlifeContact">
    <option value="">Contact with wildlife </option>
    <option value="1">Level 1</option>
    <option value="2">Level 2</option>
    <option value="3">Level 3</option>
</select>
<select name="wildlifeContactTrust" id="wildlifeContactTrust">
    <option value="">Self-trust for  wildlife contact estimation </option>
    <option value="1">None</option>
    <option value="2">Little</option>
    <option value="3">Moderate</option>
	<option value="4">High</option>
    <option value="5">Expert</option>
</select>
<p></p>
Livestock : <select name="livestockPressure" id="livestockPressure">
    <option value="">Pathogen pressure in livestock </option>
    <option value="1">Level 1</option>
    <option value="2">Level 2</option>
    <option value="3">Level 3</option>
</select>
<select name="livestockPressureTrust" id="livestockPressureTrust">
    <option value="">Self-trust for livestock pathogen pressure estimation </option>
    <option value="1">None</option>
    <option value="2">Little</option>
    <option value="3">Moderate</option>
	<option value="4">High</option>
    <option value="5">Expert</option>
</select>
<select name="livestockContact" id="livestockContact">
    <option value="">Contact with livestock </option>
    <option value="1">Level 1</option>
    <option value="2">Level 2</option>
    <option value="3">Level 3</option>
</select>
<select name="livestockContactTrust" id="livestockContactTrust">
    <option value="">Self-trust for livestock  contact estimation </option>
    <option value="1">None</option>
    <option value="2">Little</option>
    <option value="3">Moderate</option>
	<option value="4">High</option>
    <option value="5">Expert</option>
</select>
<p></p>

Wildlife/Livestock<select name="wildlifelivestockContact" id="wildlifelivestockContact">
    <option value="">Contact between wildlife and livestock </option>
    <option value="1">Level 1</option>
    <option value="2">Level 2</option>
    <option value="3">Level 3</option>
</select>
<select name="livestockWildlifeContactTrust" id="livestockWildlifeContactTrust">
    <option value="">Self-trust for wildlife/livestock contact estimation </option>
    <option value="1">None</option>
    <option value="2">Little</option>
    <option value="3">Moderate</option>
	<option value="4">High</option>
    <option value="5">Expert</option>
</select>
<p></p>
Note: <input type="text" name="note" id="note">
<input type="button" id="submit" value="submit">
</form>
<script type=text/javascript src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
<script type=text/javascript src="./jquery.serializeObject.min.js"></script>

<script>

$('#submit').on('click', function(e) {
var $form = $('form#test-form'),
    url = 'https://script.google.com/macros/s/AKfycbxKVaSGvgsTNsonRl1nANIK3dqgDNnZNMYA1WSQWZjKUCLnZdMBz0UQ-NuVeeH8m2JBvA/exec'
  e.preventDefault();
  var jqxhr = $.ajax({
    url: url,
    method: "GET",
    dataType: "json",
    data: $form.serializeObject()
  }).done(function(){
    // do something
    }
  );
  alert("Submitted successfully");
})
</script>

<script src="js/qgis2web_expressions.js"></script>
<script src="js/leaflet.js"></script>
<script src="js/leaflet.rotatedMarker.js"></script>
<script src="js/leaflet.pattern.js"></script>
<script src="js/leaflet-hash.js"></script>
<script src="js/Autolinker.min.js"></script>
<script src="js/rbush.min.js"></script>
<script src="js/labelgun.min.js"></script>
<script src="js/labels.js"></script>
<script src="data/worldadministrativeboundaries_0.js"></script>
<script>
    // Fonction pour extraire la valeur du paramètre "param" de l'URL
    function getUrlParameter(param) {
        var urlParams = new URLSearchParams(window.location.search);
        return urlParams.get(param);
    }

    var map = L.map('map', {
        zoomControl:true, maxZoom:28, minZoom:1
    }).fitBounds([[-37.499163333004,-47.81521793730427],[80.23589036176236,138.56319738816518]]);
    var hash = new L.Hash(map);
    map.attributionControl.setPrefix('<a href="https://github.com/tomchadwin/qgis2web" target="_blank">qgis2web</a> &middot; <a href="https://leafletjs.com" title="A JS library for interactive maps">Leaflet</a> &middot; <a href="https://qgis.org">QGIS</a>');
    var autolinker = new Autolinker({truncate: {length: 30, location: 'smart'}});
    function removeEmptyRowsFromPopupContent(content, feature) {
        var tempDiv = document.createElement('div');
        tempDiv.innerHTML = content;
        var rows = tempDiv.querySelectorAll('tr');
        for (var i = 0; i < rows.length; i++) {
            var td = rows[i].querySelector('td.visible-with-data');
            var key = td ? td.id : '';
            if (td && td.classList.contains('visible-with-data') && feature.properties[key] == null) {
                rows[i].parentNode.removeChild(rows[i]);
            }
        }
        return tempDiv.innerHTML;
    }
    document.querySelector(".leaflet-popup-pane").addEventListener("load", function(event) {
        var tagName = event.target.tagName,
            popup = map._popup;
        // Also check if flag is already set.
        if (tagName === "IMG" && popup && !popup._updated) {
            popup._updated = true; // Set flag to prevent looping.
            popup.update();
        }
    }, true);
    var bounds_group = new L.featureGroup([]);
    function setBounds() {}
    function pop_worldadministrativeboundaries_0(feature, layer) {
        var iso3Value = feature.properties['iso3'];

        var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (iso3Value !== null ? autolinker.link(iso3Value.toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
        layer.bindPopup(popupContent, {maxHeight: 400});
        var popup = layer.getPopup();
        var content = popup.getContent();
        var updatedContent = removeEmptyRowsFromPopupContent(content, feature);
        popup.setContent(updatedContent);
        // Mettre à jour le contenu de l'élément iso3Display et paramDisplay
        updateValueDisplay('iso3Display', iso3Value);
		updateValueDisplay('dataSubmit', '');
    }
    function style_worldadministrativeboundaries_0_0() {
        return {
            pane: 'pane_worldadministrativeboundaries_0',
            opacity: 1,
            color: 'rgba(35,35,35,1.0)',
            dashArray: '',
            lineCap: 'butt',
            lineJoin: 'miter',
            weight: 2.0,
            fillOpacity: 0,
            interactive: true,
        }
    }
    map.createPane('pane_worldadministrativeboundaries_0');
    map.getPane('pane_worldadministrativeboundaries_0').style.zIndex = 400;
    map.getPane('pane_worldadministrativeboundaries_0').style['mix-blend-mode'] = 'normal';
    var layer_worldadministrativeboundaries_0 = new L.geoJson(json_worldadministrativeboundaries_0, {
        attribution: '',
        interactive: true,
        dataVar: 'json_worldadministrativeboundaries_0',
        layerName: 'layer_worldadministrativeboundaries_0',
        pane: 'pane_worldadministrativeboundaries_0',
        onEachFeature: function(feature, layer) {
            layer.on('click', function() {
                pop_worldadministrativeboundaries_0(feature, layer);
            });
        },
        style: style_worldadministrativeboundaries_0_0,
    });
    bounds_group.addLayer(layer_worldadministrativeboundaries_0);
    map.addLayer(layer_worldadministrativeboundaries_0);
    setBounds();

    // Fonction pour mettre à jour la valeur affichée dans le champ input spécifié par son

    function updateValueDisplay(elementId, value) {
        document.getElementById(elementId).value = value;
    }

function generateUniqueFileName() {
    var timestamp = new Date().getTime(); // Obtenez le timestamp actuel
    var randomString = Math.random().toString(36).substring(7); // Générer une chaîne aléatoire
    return "file_" + timestamp + "_" + randomString + ".txt"; // Concaténer le timestamp et la chaîne aléatoire pour créer un nom de fichier unique
}

var paramValue = getUrlParameter('param');
updateValueDisplay('paramDisplay', paramValue);

</script>
<p></p>
For any questions, please e-mail <a href=mailto:benjamin.roche@ird.fr>Benjamin Roche</a>
<center>
<p><img src="./who.jpeg" width="400" height="200"></p>
</center>
</body>
</html>
